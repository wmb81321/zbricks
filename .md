# ğŸ  Tokenized House â€“ 3-Phase Continuous Auction (USDC)

This repository contains the smart contracts for selling a **single real-world house** as an **ERC-721 NFT**, using a **Continuous Clearing Auction (CCA)** with **3 phased metadata reveals** and **USDC-based bidding**.

The system is designed to be:
- Trust-minimized
- Refund-safe
- Real-asset compatible
- Simple to audit and extend

---

## ğŸ“Œ High-Level Overview

- **1 House = 1 NFT**
- Auction runs continuously
- Information is revealed in 3 phases
- Bids are placed in **USDC**
- Losing bidders can always withdraw safely
- Ownership transfers **once**, at the end

---

## ğŸ§± Architecture

### Contracts

| Contract | Responsibility |
|--------|----------------|
| `HouseNFT.sol` | ERC-721 representing the house |
| `AuctionManager.sol` | Auction logic, bidding, refunds, phase control |

### Design Principle

> **Auction phases control information, not ownership**

Ownership is transferred **only once**, after the final phase.

---

## ğŸ  HouseNFT Contract

### Purpose
- Represent the physical house as a single NFT
- Serve metadata dynamically based on auction phase
- Transfer ownership to the auction winner

### Key Properties
- ERC-721
- Exactly **1 token** (`tokenId = 1`)
- Metadata stored on IPFS
- URI changes per phase (IPFS content is immutable)

### Metadata Phases

| Phase | Description |
|------|------------|
| 0 | Placeholder / teaser |
| 1 | Partial information |
| 2 | Additional disclosures |
| 3 | Full house details |

### Rules
- Only `AuctionManager` can advance phases
- Phases are sequential
- No rollback allowed

---

## ğŸ” AuctionManager Contract

### Auction Type
**Continuous Clearing Auction (CCA)**

- Bids are continuous
- Highest bid at the end wins
- No fixed price
- Price discovery evolves as information is revealed

---

### Phases (Hybrid Control)

Each phase requires **both**:
- â± Minimum time elapsed
- ğŸ” Admin manual confirmation

Admin **cannot**:
- Skip phases
- Reveal early
- Finalize early

---

## ğŸ’µ Bidding (USDC)

- ERC-20 USDC (6 decimals)
- Bidders must `approve()` before bidding
- Funds are escrowed in `AuctionManager`

### Bidding Rules
- Bid must be strictly higher than current phase leader
- Highest bidder becomes phase leader
- Previous leader is refunded via pull-based withdrawals

---

## ğŸ”„ Refunds (Critical)

Refunds use a **pull payment pattern**:

- No automatic transfers
- No loops
- No reentrancy risk

### Rules
- Any losing bidder can withdraw at any time
- Final winner cannot withdraw
- Refund balance is tracked per address

---

## ğŸ Auction Finalization

### Conditions
- All 3 phases completed
- Admin explicitly finalizes

### Outcome
- Phase 3 leader is the winner
- NFT ownership transferred to winner
- USDC remains escrowed for withdrawal by seller / treasury

---

## ğŸ¦ Proceeds

- Withdrawable only after finalization
- Sent to seller, escrow, SPV, or multisig
- Controlled by admin (recommended: multisig)

---

## ğŸ” Roles & Access Control

| Role | Permissions |
|----|------------|
| Admin | Advance phases, finalize auction, withdraw proceeds |
| Bidders | Place bids, withdraw refunds |
| AuctionManager | Control NFT state |

**Production recommendation:**  
Admin should be a **multisig**, not an EOA.

---

## ğŸ“¡ Events

### Auction Events
- `BidPlaced(phase, bidder, amount)`
- `PhaseRevealed(phase, leader, price)`
- `AuctionFinalized(winner, price)`
- `RefundWithdrawn(bidder, amount)`

### NFT Events
- Standard ERC-721 `Transfer`

---

## ğŸ”’ Security Guarantees

- No ETH usage
- No external calls during bidding
- Refunds are pull-based
- No loops over bidders
- Immutable USDC address
- Sequential phase enforcement

---

## ğŸš« Out of Scope

The following are intentionally excluded:
- Fractional ownership
- Multiple NFTs
- Automatic phase reveals
- On-chain legal enforcement
- Forced refunds

---

## ğŸš€ Deployment Order

1. Deploy `HouseNFT`
2. Deploy `AuctionManager`
3. Set `AuctionManager` as controller in `HouseNFT`
4. Upload all IPFS metadata (phases 0â€“3)
5. Start auction

---

## ğŸ§ª Recommended Next Steps

- Add Foundry tests (refund edge cases)
- Use a multisig for admin
- Index events with a subgraph
- Integrate legal / escrow layer off-chain

---

## ğŸ“„ License

MIT